# Работа с файлами

## GET-запросы

### listmedia

**/listmedia** - запрос на сервер для получения списка всех медиафайлов на сервере.
Запрос внутри себя не должен содержать никаких дополнитльеных вложений.

В ответ могут быть получены статусы: 200 и 500.

- ***200*** - говорит об успешности получения запроса и имеет приложенный ответ от сервера в виде json-файла. Формат оформления json-ф см. в прил. А.
- ***500*** - говорит об ошибке при обработки запроса по причине:
    * "Error reading files" - если по какой-либо внутренней причине директория с файлами или сами файлы недоступны на сервере.
    * говорит об внутренней ошибке на сервере

### viewmedia

**/viewmedia/:file_name/:frame_num** - запрос на сервер для получения стоп-кадров из видео. Все данные для отправки идут прямо в строке запроса.
Под именем file_name отправляется имя видео (вместе с расширением) кадр которого нужно получить. Под именем frame_num идет целое число от 0 и больше, которое указывает номер стоп-кадра из доступных.
Стоп-кадры генерируются для каждого видео один раз при загрузку или конвертации и хранятся там вплоть до удаления самого видео. После новой загрузки файла, сгенерируются новые стоп-кадры.

В ответ может быть получен файл изображения в формате jpg.

## POST-запросы

### uploadmedia

**/uploadmedia** - запрос на сервер для загрузки любых медиафайлов на сервер.
Содержит внутри себя FormData элемент, в первой части которого лежит сам медиафайл (mediaFile), а во второй json файл (jsonData).
Внутри json файла лежит описание медиафайла. Формат оформления json-а см. в прил. Сервер ожидают форму с медиафайлов под именем 'mediaFile' и файлом описания 'jsonFile', где второй должен быть упакован просто строкой.
**ВАЖНО: все видео и фото получат размеры 1920x1080**

В ответ могут быть получены статусы: 200, 400, 500.

- ***200*** - говорит об успешности загрузки с сопроводительным сообщением "Data uploaded successfully"
- ***400*** - говорит об ошибке загрузке по одной из причин:
    * "Invalid file information" - если json был некорреткным или имел не все поля
    * "Invalid file type" - если указан недопустимый тип файла
    * "Invalid file format" - если указан недопустимый формат файла
    * "File already exists" - если файл с таким именем и расширением уже имеется на сервере
    * "Media file is required" - если в mediaFile не получилось считать данные
- ***500*** - говорит об внутренней ошибке на сервере

## DELETE-запросы

### deletemedia

**/deletemedia** - запрос на сервер для удаления любого медиафайла с него (который виден черен /listmedia).
Запрос внутри себя обязан содержать json файл (jsonData) внутри которого хранится вся информация об удаляемом файле. Формат оформления json-а см. в прил. А.
Сервер ожидает данные в теле запроса. Для корректного распознавания, нужно отправить данные под именем data, без форматирования в строку.

В ответ могут быть получены статусы: 200, 400, 404, 500.

- ***200*** - говорит об успешности удаления файла с сервера с сопроводительным сообщением "File deleted successfully"
- ***404*** - говорит об какой-то ошибке связанной внтуренней работой сервера или сети с сообщением "File not found"
- ***400*** - говорит об ошибке удаления по одной из причин:
    * "Invalid file information" - если json был некорреткным или имел не все поля
    * "Invalid file type" - если указан недопустимый тип файла
    * "Invalid file format" - если указан недопустимый формат файла
    * "Json file about media file not found" - если не был найден файл json описывающий данный медиафайл
    * "Mismatch in file data" - если в найденном json файле описывающем данный медиафайл - не все данные совпадают с запрашиваемыми в вашем json файле
    * "Media file is not source" - если медиафайл является не загруженным а программно созданным
    * "Media file is using" - если данный медиафайл сейчас используется где-то в трансялции или запланирован использоваться на будущее
    * "Media file not found" - если сам медиафайл не был найден
- ***500*** - говорит об внутренней ошибке на сервере

### deleteallrefmedia

**/deleteallrefmedia** - запрос на сервер для удаления всех неиспользуемых программно созданных медиафайлов.
Сервер ничего не ожидает и ничего не возвращает.

В ответ могут быть получены статусы: 200.

- ***200*** - говорит об успешности удаления всех программно созданных медиафайлов с сопроводительным сообщением "All ref media are deleted"

### deleteallrefmedia

**/deleteunloadedmedia** - запрос на сервер для удаления всех неправильно загруженных медиафайлов, если таковые имеются.
Сервер ничего не ожидает и ничего не возвращает.

В ответ могут быть получены статусы: 200.

- ***200*** - говорит об успешности удаления всех программно созданных медиафайлов с сопроводительным сообщением "All undloaded media are deleted"

## PUT-запросы

### tovideo

**/tovideo** - запрос на сервер для конвертирования презентации или изображения в видео.
Запрос внутри себя обязан содержать массив из 3-х json фрагментов (см. прил. А). Первым фрагментом является информация об исходном файле, который нужно конвертировать,
вторым - в который нужно конвертировать, третьим - количество секунд для каждого изображения в будущем видео (для картинки это будет всё видео, а для презентации КОЛ-ВО СЛАЙДОВ * СЕКУНДЫ).
Отправлять данные в теле запроса сразу как массив, чтобы к телу можно было обратиться по индексу.

В ответ могут быть получены статусы: 200, 400 и 500.

- ***200*** - говорит об успешности загрузки с сопроводительным сообщением "File converting"
- ***400*** - говорит об ошибке загрузке по одной из причин:
    * "Invalid request body" - если в теле не все корректно
    * "Missing required fields in file data" - если ошибка в компонентах json-а
    * "Invalid file type" - если указан недопустимый тип файла (любого)
    * "Invalid file format" - если указан недопустимый формат файла (любого)
    * "New file do not have video format" - если итоговоый файл не является видео
    * "Old file is video" - если исходный файл является видео
    * "Source file not already exists" - если исходный файл не был найден
    * "Output file already exists" - если итоговый файл уже существовал
    * "Source file is incorrect" - если какие-то проблемы с типом исходного файла
    * Также ошибки в работе системы, но маловероятно.
- ***500*** - говорит об внутренней ошибке на сервере

# Работа с трансляцией

## GET-запросы

### listelements

**/listelements** - запрос на сервер для получения для получения всей очереди видеофрагментов.
Запрос внутри себя не должен ничего содержать. В случае успешной обработки, в ответ будет получен список всех добавленных в очередь видеофрагментов.
Пример получаемого запроса см. в прил. А.

- ***200*** - говорит об успешности получения запроса и имеет приложенный ответ от сервера в виде json-файла.

## POST-запросы

### placeelement

**/placeelement** - запрос на сервер для помещения видеофрагмента (из доступных на сервере) в очередь на воспроизведение.
Запрос внутри себя обязан содержать данные как в прил. А прямо в теле запроса. Информация, указываемая в полях должна говорить о файле, который уже лежит на сервере.
Также указывается планируемая дата и время показа видеофрагмента, а также, локальный часовой пояс устрйоства, с которого выполняется запрос. Значение приоритетности влияет на то,
сможет ли данный видеофрагмент накладываться поверх других.

В ответ могут быть получены статусы: 200, 500 и 400.

- ***200*** - говорит об успешности загрузки с сопроводительным сообщением "Element added"
- ***400*** - говорит об ошибке загрузке по одной из причин:
    * "Invalid request body" - в теле запроса нет информации
    * "Invalid file information" - информация в теле запроса некорректна
    * "Invalid file type" - неверный тип указанного файла
    * "Invalid file format" - неверный формат указанного файла
    * "Source file not already exists" - файл на сервере не существует
    * "Date is not correct" - некорректное значение даты и времени
    * "TimeZone is not correct" - несуществубщий часовой пояс
    * "Time has already passed" - попытка расположить начало фрагмента в прошлом
    * "Multiple layers" - данный видеофрагмент пересекается с другим видеофрагментом с такой или большей приоритетностью
    * "Video seconds dont match" - введено несовпадающее с оригинальным видео количество секунд
- ***500*** - говорит об внутренней ошибке на сервере

## DELETE-запросы

#### deleteelement

**/deleteelement** - запрос на сервер для удаления видеофрагмента из очереди (из доступных на сервере).
Запрос внутри себя обязан содержать данные как в прил. А прямо в теле запроса.

В ответ могут быть получены статусы: 200, 500, 400.

- ***200*** - говорит об успешности перемещения видеофрагмента с сопроводительным сообщением "Element deleted"
- ***500*** - говорит об ошибке ненахождения указанного элемента в очереди с сопроводительным письмом "Element not exists"
- ***400*** - говорит об ошибке перемещения по одной из причин:
    * "Invalid request body" - в теле запроса нет информации
    * "Invalid file information" - информация в теле запроса некорректна
    * "Currently in use" - видеофрагмент сейчас воспроизводится
- ***500*** - говорит об внутренней ошибке на сервере или:
    * "Element not exists" - элемент не найден

## PUT-запросы

### moveelement

**/moveelement** - запрос на сервер для перемещения элемента в очереди из одного места в другое.
Запрос внутри себя обязан содержать данные как в прил. А прямо в теле запроса. Новые дата и время старта показа видеофрагмента должны указываться по локальному часовому поясу устрйоства.

В ответ могут быть получены статусы: 200, 500, 400.

- ***200*** - говорит об успешности перемещения видеофрагмента с сопроводительным сообщением "Element moved"
- ***500*** - говорит об:
    * "Element not exists" - ошибка ненахождения указанного элемента в очереди
    * внутренней ошибке на сервере
- ***400*** - говорит об ошибке перемещения по одной из причин:
    * "Invalid request body" - в теле запроса нет информации
    * "Invalid file information" - информация в теле запроса некорректна
    * "Date is not correct" - некорректное значение даты и времени
    * "TimeZone is not correct" - несуществубщий часовой пояс
    * "Multiple layers" - новая версия видеофрагмента пересекается с другим видеофрагментом с такой или большей приоритетностью (не старым собой)

# Приложение А

## Формат uploadmedia на отправку

```json
{
    "file_type": "",            // Тип файла (image, presentation, video)
    "file_name": "",            // Имя файла (без точки и расширения)
    "file_format": "",          // Формат файла (расширение без точки)
}
```

## Формат listmedia на получение

```json
{
    {
        "file_type": "",        // Тип файла (image, presentation, video)
        "file_name": "",        // Имя файла (без точки и расширения)
        "file_format": "",      // Формат файла (расширение без точки)
        "seconds": 0.0,         // Сколько секунд длится (существует только для video)
        "value_type": "",       // Тип файла: загруженный (source) и программно созданный (ref)
        "refs": []              // Массив id тех элементов, которые воспроизводят этот файл
    },
    {
        "file_type": "",
        "file_name": "",
        "file_format": "",
        "value_type": "",
        "refs": []
    },
    ...
}
```

## Формат deletemedia на отправку

```json
{
    "file_type": "",            // Тип файла (image, presentation, video)
    "file_name": "",            // Имя файла (без точки и расширения)
    "file_format": ""           // Формат файла (расширение без точки)
}
```

## Формат tovideo на отправку

```json
[
    {
        "file_type": "",        // Тип файла (image, presentation)
        "file_name": "",        // Имя файла (без точки и расширения)
        "file_format": ""       // Формат файла (расширение без точки)
    },
    {
        "file_type": "video",   // Тип файла (video)
        "file_name": "",        // Имя файла (без точки и расширения)
        "file_format": ""       // Формат файла (расширение без точки)
    },
    {
        "seconds": 0
    }
]
```

## Формат placeelement на отправку

```json
{
    "file_type": "video",       // Тип оригинального файла (video)
    "file_name": "",            // Имя оригинального файла
    "file_format": "",          // Формат оригинального файла
    "full_start_time": "",      // Полная дата и время начала показа (формат YYYY-MM-DD HH:mm:ss по часовому поясу своего устройства)
    "seconds": 0,               // Длительность показа. У видео используется исходная длительность. У презентаций и фотографий указанная
    "time_zone": "",            // Часовой пояс, в котором находится свое устройство
    "priority": 1               // Уровень приоритетности
}
```

## Формат listelements на получение

```json
[
    {
        "id": 1,                // Идентификационный номер
        "file_name": "",        // Имя оригинального видеофайла
        "file_format": "",      // Формат оригинального видеофайла
        "full_datetime_start": "",  // Время начала проигрывания видеофрагмента (формат YYYY-MM-DD HH:mm:ss по часовому поясу сервера)
        "full_datetime_end": "",    // Время конца проигрывания видеофрагмента (формат YYYY-MM-DD HH:mm:ss по часовому поясу сервера)
        "priority": 1           // Уровень приоритетности
    },
    {
        "id": 2,
        "file_name": "",
        "file_format": "",
        "full_datetime_start": "",
        "full_datetime_end": "",
        "priority": 1
    },
    ...
    { "timezone": "" }          // Часовой пояс в котором находится сервер (Asia/Novosibisk, Europe/Moscow)
]
```

## Формат moveelement на отправку
```json
{
    "id_element": 1,            // Идентификационный номер существующего видеофрагмента
    "full_datetime_start_new": "",  // Полная новая дата и время начала показа (формат YYYY-MM-DD HH:mm:ss по часовому поясу своего устройства)
    "time_zone": ""             // Часовой пояс, в котором находится свое устройство
}
```

## Формат deleteelement на отправку
```json
{
    "id_element": 1             // Идентификационный номер существующего видеофрагмента
}
```

# Приложение Б

## Доступные для загрузки форматы

**image**
- png
- jpg
- jpeg

**presentation**
- pdf

**video**
- mp4
- mov